{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Donor Profile</title>
<style>
/* RESET & GLOBAL */
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #111;
    background: url("{% static 'images/homebg0.png' %}") center center/cover no-repeat;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* FORM BOX */
.form-box {
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,245,245,0.95));
    padding: 35px 45px;
    border-radius: 15px;
    max-width: 500px;
    width: 100%;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    text-align: center;
}
h2 {
    color: #d32f2f;
    margin-bottom: 25px;
}

/* PROFILE PREVIEW */
.profile-preview {
    position: relative;
    margin-bottom: 15px;
}
.profile-preview img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ffd700;
    margin-bottom: 5px;
    cursor: pointer;
    transition: transform 0.3s;
}
.profile-preview img:hover { transform: scale(1.05); }
.remove-photo {
    display: block;
    font-size: 0.85em;
    color: crimson;
    cursor: pointer;
    text-decoration: underline;
}

/* FORM GRID */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px 15px;
}
.form-grid .full-width { grid-column: span 2; }
input, select {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 15px;
    transition: 0.3s;
    width: 100%;
}
input:focus, select:focus {
    border-color: #d32f2f;
    box-shadow: 0 0 8px rgba(211,47,47,0.5);
    outline: none;
}

/* BUTTONS */
button, .btn {
    width: 100%;
    padding: 14px;
    margin-top: 15px;
    background: #d32f2f;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    transition: background 0.3s ease, transform 0.2s ease;
}
button:hover, .btn:hover {
    background: #b71c1c;
    transform: scale(1.03);
}

/* FILE INPUT */
.file-input-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
}
.file-input-container label {
    font-weight: bold;
    color: #000000;
    font-size: 0.95em;
    white-space: nowrap;
}
.file-input-container input[type="file"] { flex: 1; }

/* MESSAGES */
.messages { list-style: none; padding: 0; margin-bottom: 15px; }
.messages li {
    background-color: #f8d7da;
    color: #721c24;
    padding: 8px;
    margin-bottom: 8px;
    border-radius: 5px;
    text-align: center;
    font-size: 14px;
}

/* Responsive */
@media (max-width: 500px) {
    .form-grid { grid-template-columns: 1fr; }
    .form-grid .full-width { grid-column: span 1; }
}
</style>
</head>
<body>
<div class="form-box">
    <h2>Edit Profile</h2>

    {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    <div class="profile-preview">
        {% if donor.profile_pic %}
            <img id="previewImg" src="{{ donor.profile_pic.url }}" alt="Profile Picture">
        {% else %}
            <img id="previewImg" src="{% static 'images/default-profile.png' %}" alt="Default Picture">
        {% endif %}
        <span class="remove-photo" onclick="removePhoto()">Remove Photo</span>
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-grid">
            <input type="text" name="name" value="{{ donor.name }}" placeholder="Name" required>
            <input type="email" name="email" value="{{ donor.email }}" placeholder="Email" required>
            <input type="password" name="password" placeholder="New Password (leave blank to keep old)">
            <input type="text" name="phone" value="{{ donor.phone }}" placeholder="Phone" required>
            <input type="number" name="age" value="{{ donor.age }}" min="18" max="65" placeholder="Age">
            <select name="gender" required>
                <option value="">-- Select Gender --</option>
                <option value="Male" {% if donor.gender == 'Male' %}selected{% endif %}>Male</option>
                <option value="Female" {% if donor.gender == 'Female' %}selected{% endif %}>Female</option>
                <option value="Other" {% if donor.gender == 'Other' %}selected{% endif %}>Other</option>
            </select>
            <select name="blood_group" required>
                <option value="">-- Select Blood Group --</option>
                <option value="A+" {% if donor.blood_group == 'A+' %}selected{% endif %}>A+</option>
                <option value="A-" {% if donor.blood_group == 'A-' %}selected{% endif %}>A-</option>
                <option value="B+" {% if donor.blood_group == 'B+' %}selected{% endif %}>B+</option>
                <option value="B-" {% if donor.blood_group == 'B-' %}selected{% endif %}>B-</option>
                <option value="AB+" {% if donor.blood_group == 'AB+' %}selected{% endif %}>AB+</option>
                <option value="AB-" {% if donor.blood_group == 'AB-' %}selected{% endif %}>AB-</option>
                <option value="O+" {% if donor.blood_group == 'O+' %}selected{% endif %}>O+</option>
                <option value="O-" {% if donor.blood_group == 'O-' %}selected{% endif %}>O-</option>
            </select>
            <select name="state" id="state" required>
                <option value="Kerala" selected>Kerala</option>
            </select>
            <select name="district" id="district" required>
                <option value="">--Select District--</option>
            </select>
            <input type="text" name="location" value="{{ donor.location }}" placeholder="Location" class="full-width">
        </div>

        <div class="file-input-container">
            <label for="profile_pic">Upload New Photo:</label>
            <input id="profile_pic" type="file" name="profile_pic" accept="image/*" onchange="previewFile(event)">
        </div>

        <input type="hidden" name="remove_photo" id="remove_photo" value="0">

        <button type="submit">Update Profile</button>
        <a href="{% url 'donor_profile' %}" class="btn">Back to Profile</a>
    </form>

    <!-- Delete Account Form -->
    <form method="post" action="{% url 'delete_donor' donor.id %}" 
          onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
        {% csrf_token %}
        <button type="submit" class="btn" style="background-color: #b71c1c;">Delete Account</button>
    </form>
</div>

<script>
// Preview profile picture
function previewFile(event) {
    const reader = new FileReader();
    reader.onload = function(){
        const output = document.getElementById('previewImg');
        output.src = reader.result;
        document.getElementById('remove_photo').value = '0';
    };
    reader.readAsDataURL(event.target.files[0]);
}

// Remove profile photo
function removePhoto() {
    document.getElementById('previewImg').src = "{% static 'images/default-profile.png' %}";
    document.getElementById('remove_photo').value = '1';
}

// Populate Kerala districts dynamically
const keralaDistricts = [
  "Alappuzha","Ernakulam","Idukki","Kannur","Kasaragod","Kollam",
  "Kottayam","Kozhikode","Malappuram","Palakkad","Pathanamthitta",
  "Thiruvananthapuram","Thrissur","Wayanad"
];

const districtSelect = document.getElementById("district");
keralaDistricts.forEach(district => {
    const option = document.createElement("option");
    option.value = district;
    option.textContent = district;
    if ("{{ donor.district }}" === district) {
        option.selected = true;
    }
    districtSelect.appendChild(option);
});
</script>
</body>
</html>
